!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=5)}([function(e,t,n){function r(){return r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r.apply(this,arguments)}var o=n(16),a=n(4);e.exports=r({},o,a)},function(e,t){e.exports=require("path")},function(e,t,n){function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return n}function a(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return o(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}function i(){return i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i.apply(this,arguments)}function c(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){function a(e,t){try{var n=s[e](t),a=n.value}catch(e){return void o(e)}n.done?r(a):Promise.resolve(a).then(i,c)}function i(e){a("next",e)}function c(e){a("throw",e)}var s=e.apply(t,n);i()})}}function s(e,t,n){return u.apply(this,arguments)}function u(){return u=c(regeneratorRuntime.mark(function e(t,n,r){var o,a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(d.connect(p));case 2:return o=e.sent,a=o.db(m).collection(r),e.next=6,x(a.find().project({_id:0}).toArray());case 6:i=e.sent,n.json(i),o.close();case 9:case"end":return e.stop()}},e,this)})),u.apply(this,arguments)}function l(e,t){return new Promise(function(){var n=c(regeneratorRuntime.mark(function n(r,o){var a,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return a=e.db(m).collection("liveQuestions"),n.next=3,x(a.findOne({cardId:t}));case 3:return i=n.sent,n.next=6,x(a.remove(i));case 6:return n.next=8,x(f(e,i));case 8:r();case 9:case"end":return n.stop()}},n,this)}));return function(e,t){return n.apply(this,arguments)}}())}function f(e,t){var n=t.cachedPoints,r=t.cardId;return new Promise(function(){var t=c(regeneratorRuntime.mark(function t(o,a){var i,c,s,u,l,f,d,p,v;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(i=e.db(m).collection("scoreboard"),c=e.db(m).collection("oldCards"),s=(new Date).getTime(),c.updateOne({cardId:r},{$set:{answerPostedAt:s}}),u=[],l=0;l<n.length;++l)f=n[l],d=f.userId,p=f.points,v={updateOne:{filter:{userId:d},update:{$inc:{"allTimeStats.score":p,"monthlyStats.score":p,"weeklyStats.score":p,"allTimeStats.attempts":1,"monthlyStats.attempts":1,"weeklyStats.attempts":1}}}},p>0&&(v.updateOne.update.$push={"allTimeStats.correct":{answerPostedAt:s,cardId:r,points:p}},v.updateOne.update.$inc["monthlyStats.correct"]=1,v.updateOne.update.$inc["weeklyStats.correct"]=1),u.push(v);if(0!==u.length){t.next=9;break}return o(),t.abrupt("return");case 9:return t.next=11,x(i.bulkWrite(u));case 11:o();case 12:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}())}var d=n(11).MongoClient,p=process.env.MONGODB_URI,m=process.env.MONGO_DB,v=n(12),h=v.processUpload,w=n(0),x=w.tryCatch;e.exports={getRandomQuestion:function(){return new Promise(function(){var e=c(regeneratorRuntime.mark(function e(t,n){var r,o,a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(d.connect(p));case 2:return r=e.sent,o=r.db(m).collection("newCards"),a=r.db(m).collection("oldCards"),e.next=7,x(o.findOne());case 7:if(null!=(i=e.sent)){e.next=11;break}return n(new Error("Empty deck. Please Add More Cards to DB.")),e.abrupt("return");case 11:return e.next=13,x(a.insert(i));case 13:return e.next=15,x(o.remove(i));case 15:t(i),r.close();case 17:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}())},revealAnswerWorkflow:function(e){return new Promise(function(){var t=c(regeneratorRuntime.mark(function t(n,r){var o,a,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x(d.connect(p));case 2:return o=t.sent,a=o.db(m).collection("oldCards"),t.next=6,x(a.findOne({cardId:e}));case 6:return i=t.sent,n(i),t.next=10,x(l(o,e));case 10:o.close();case 11:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}())},addLiveQuestion:function(){var e=c(regeneratorRuntime.mark(function e(t,n){var r,o,a,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.cardId,e.next=3,x(d.connect(p));case 3:return o=e.sent,a=o.db(m).collection("liveQuestions"),c=o.db(m).collection("oldCards"),e.next=8,x(a.insert(i({},t,{mediaUrls:n})));case 8:return e.next=10,x(c.updateOne({cardId:r},{$set:{mediaUrls:n},$unset:{questionImg:"",questionAltText:"",prevLineImg:"",prevLineAltText:""}}));case 10:o.close();case 11:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),addMediaUrlsToCard:function(){var e=c(regeneratorRuntime.mark(function e(t,n){var r,o,i,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a(n,1),o=r[0],e.next=3,x(d.connect(p));case 3:return i=e.sent,c=i.db(m).collection("oldCards"),e.next=7,x(c.updateOne({cardId:t},{$push:{mediaUrls:o},$unset:{answerImg:"",answerAltText:""}}));case 7:i.close();case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),updateLiveQuestion:function(){var e=c(regeneratorRuntime.mark(function e(t,n){var r,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(d.connect(p));case 2:return r=e.sent,o=r.db(m).collection("liveQuestions"),a=n.userId,e.next=7,x(o.update({questionId:t},{$push:{alreadyAnswered:a,cachedPoints:n}}));case 7:r.close();case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),getLiveQuestions:function(){return new Promise(function(){var e=c(regeneratorRuntime.mark(function e(t,n){var r,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(d.connect(p));case 2:return r=e.sent,o=r.db(m).collection("liveQuestions"),e.next=6,x(o.find().toArray());case 6:a=e.sent,t(a),r.close();case 9:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}())},serveLiveQuestions:function(){var e=c(regeneratorRuntime.mark(function e(t,n){var r,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(d.connect(p));case 2:return r=e.sent,o=r.db(m).collection("liveQuestions"),e.next=6,x(o.find().toArray());case 6:a=e.sent,n.json(a),r.close();case 9:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),addOrUpdateUser:function(){var e=c(regeneratorRuntime.mark(function e(t){var n,o,a,i,c,s,u,l,f,v;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(d.connect(p));case 2:return n=e.sent,o=n.db(m).collection("scoreboard"),a=t.userId,e.next=7,x(o.findOne({userId:a}));case 7:if(!(i=e.sent)){e.next=14;break}return s=t.name,u=t.handle,l=t.avatar,f=t.profileBanner,v=t.following,e.next=12,x(o.updateOne({userId:a},(c={$set:{name:s}},r(c,"$set",{handle:u}),r(c,"$set",{avatar:l}),r(c,"$set",{profileBanner:f}),r(c,"$set",{following:v}),c)));case 12:e.next=16;break;case 14:return e.next=16,x(o.insert(t));case 16:n.close();case 17:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),adjustScore:function(e,t){},getScores:function(){var e=c(regeneratorRuntime.mark(function e(t,n){var r,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(d.connect(p));case 2:return r=e.sent,o=r.db(m).collection("scoreboard"),e.next=6,x(o.find().sort("weeklyStats.score",-1).project({_id:0}).toArray());case 6:a=e.sent,n.json(a),r.close();case 9:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),getScore:function(){var e=c(regeneratorRuntime.mark(function e(t,n){var r,o,a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.params.handle,e.next=3,x(d.connect(p));case 3:return o=e.sent,a=o.db(m).collection("scoreboard"),e.next=7,x(a.findOne({handle:r}));case 7:i=e.sent,n.json(i),o.close();case 10:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),addDeck:function(){var e=c(regeneratorRuntime.mark(function e(t,n){var r,o,a,i,c,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.file.path,e.next=3,x(h(r));case 3:return o=e.sent,e.next=6,x(d.connect(p));case 6:for(a=e.sent,i=a.db(m).collection("newCards"),c=i.initializeUnorderedBulkOp(),s=0;s<o.length;++s)c.insert(o[s]);return e.next=12,x(c.execute());case 12:a.close(),n.redirect("/");case 14:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),getNewCards:function(e,t){s(e,t,"newCards")},getOldCards:function(e,t){s(e,t,"oldCards")},weeklyMonthlyReset:function(){var e=c(regeneratorRuntime.mark(function e(t,n){var r,o,a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(d.connect(p));case 2:r=e.sent,o=r.db(m).collection("scoreboard"),a={score:0,attempts:0,correct:0},i={$set:{}},t&&(i.$set.weeklyStats=a),n&&(i.$set.monthlyStats=a),o.update({},i,{multi:!0}),r.close();case 10:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),getCards:function(){var e=c(regeneratorRuntime.mark(function e(t,n){var r,o,a,i,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.query.ids,e.next=3,x(d.connect(p));case 3:return o=e.sent,a=o.db(m).collection("oldCards"),e.next=7,x(a.find({cardId:{$in:r}}).project({_id:0,mediaUrls:1,questionText:1,answers:1}).toArray());case 7:i=e.sent,c=i.map(function(e){e.questionText=e.questionText.split("\n")[0];var t=e.answers.length>1?"s":"";return e.answers="Answer".concat(t,": ").concat(e.answers.join(", ")),e.mediaUrl=3===e.mediaUrls.length?e.mediaUrls[1]:e.mediaUrls[0],delete e.mediaUrls,e}),n.json(c),o.close();case 11:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}},function(e,t,n){var r=n(17),o=process.env,a=o.TWITTER_API_KEY,i=o.TWITTER_API_SECRET,c=o.TWITTER_TOKEN,s=o.TWITTER_TOKEN_SECRET,u=(o.TWITTER_ACCOUNT,{consumer_key:a,consumer_secret:i,access_token:c,access_token_secret:s});e.exports=new r(u)},function(e,t,n){function r(e){return Array.isArray(e)?e:Array.from(e)}function o(e){throw new Error('"'+e+'" is read-only')}function a(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return n}function i(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return a(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}function c(e){return-1!==e}function s(e){return 0!==e.replace(/\[\]/g,"").trim().length}function u(e){var t=/\[.*?\]/g;return(e.match(t)||[]).length+e.replace(t,"").replace(/[\s+\(\)]/g,"").length}function l(e){var t=(e.match(/\?/g)||[]).length;return u(e)-t}function f(e){return[l(e),u(e)]}function d(e){return x(h(v(m(p(e.match(/\:\:.+?\:\:(.+?)\}\}/)[1]))))).map(function(e){if("."===e)return"[]";if("-"===e)return"[] [] [] [] []";if(/\?/.test(e)){for(var t=[],n=Number(e.match(/\d+/)[0]),r=0;r<n;r++)t.push("[?]");return 1===t.length?"[?]":"("+t.join(" ")+")"}return/≠/.test(e)?"[≠".concat(e.replace(/≠/g,""),"]"):e}).join(" ")}function p(e){return e.replace(/(\?+)/g,function(e,t){return"(".concat(t.length,"?)")})}function m(e){return e.replace(/≠[^(]/g,"($&)")}function v(e){return e.replace(/≠\((.*)\)/g,"(≠$1)")}function h(e){return e.split(/[\(\)]/).map(function(e){return/\?|≠/.test(e)?e:e.split("")})}function w(e){return!Array.isArray(e)}function x(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(0===e.length)return t;var n=r(e),o=n[0],a=n.slice(1);return w(o)?x(a,t.concat(o)):x(a,t.concat(x(o)))}var g=n(18),y=process.env.TWITTER_ACCOUNT;e.exports={HOURS:36e5,formatQuestionAltText:function(e){var t=d(e),n=f(t),r=i(n,2),o=r[0],a=r[1],c=o===a?o:"".concat(o," to ").concat(a),s=a>1?"s":"",u="(".concat(c," character").concat(s,")");return e.replace(/\{\{.+?\}\}/g,u)},formatQuestionText:function(e,t,n,r){var o=d(e),a=f(o),c=i(a,2),u=c[0],l=c[1],p=u===l?u:"".concat(u,"-").concat(l),m="What ".concat(p,' character answer means "').concat(t,'"?');return s(o)&&(m+="\nHint: ".concat(o)),n&&(m+="\nNotes: ".concat(n)),m+="\nQID".concat(r)},formatAnswerAltText:function(e){return e.replace(/\{\{.*?\:\:(.+?)\:\:.*?\}\}/g,"$1")},formatAnswerText:function(e,t,n,r){var o=e.length>1?"s":"",a="Answer".concat(o,": ").concat(e.join(", "));return a+='\nEnglish Meaning: "'.concat(t,'"'),a+="\nDefinition: https://ejje.weblio.jp/content/"+g(n),a+="\nQID".concat(r)},addQuestionLink:function(e,t){var n="Question: twitter.com/".concat(y,"/status/").concat(t),r=e.split("\n");return r.splice(-1,0,n),r.join("\n")},getAnswers:function(e,t){var n=e.match(/\:\:(.+?)\:\:/)[1],r=[];return t&&t.length>0&&(r=t.split(",")),[n].concat(r)},calculateScore:function(e,t){var n=t.questionPostedAt,r=(t.alreadyAnswered,Math.floor((new Date(e)-new Date(n))/36e5)),o=24-r;return Math.max(o,0)},extractAnswer:function(e){return e.trim().slice(y.length+2)},getTimeUntil:function(e){var t=new Date,n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),e,0,0,0)-t;return n<0&&(n+=(o("millisUntilTime"),864e5)),n},tryCatch:function(e){return e.then(function(e){return e}).catch(function(e){return console.error("Error:",e),{}})},contains:function(e,t){return c(t.indexOf(e))}}},function(e,t,n){n(6),e.exports=n(7)},function(e,t){e.exports=require("babel-polyfill")},function(e,t,n){var r=n(8),o=r(),a=n(1),i=n(9);n(10);o.set("port",process.env.PORT||3e3),o.use(r.static(a.resolve(__dirname,"../dist"))),o.use(i.json()),n(19)(o),o.listen(o.get("port"),function(){return console.log("Listening on port",o.get("port"))}),e.exports=o},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("body-parser")},function(e,t,n){function r(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){function a(e,t){try{var n=s[e](t),a=n.value}catch(e){return void o(e)}n.done?r(a):Promise.resolve(a).then(i,c)}function i(e){a("next",e)}function c(e){a("throw",e)}var s=e.apply(t,n);i()})}}function o(){return a.apply(this,arguments)}function a(){return a=r(regeneratorRuntime.mark(function e(){var t,n,r,o,a,c,s,l,f,d,p,m,v;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w(u.getRandomQuestion());case 2:if(t=e.sent,n=t.cardId,r=t.questionText,o=t.questionImg,a=t.questionAltText,c=t.prevLineImg,s=t.prevLineAltText,l=t.answers,n){e.next=12;break}return e.abrupt("return");case 12:return e.next=14,w(h(r,o,a,c,s));case 14:f=e.sent,d=f.questionId,p=f.questionPostedAt,m=f.mediaUrls,v={cardId:n,questionId:d,questionText:r,answers:l,questionPostedAt:p,cachedPoints:[],alreadyAnswered:[]},u.addLiveQuestion(v,m),setTimeout(function(){return i(n,d)},y);case 21:case"end":return e.stop()}},e,this)})),a.apply(this,arguments)}function i(e,t){return c.apply(this,arguments)}function c(){return c=r(regeneratorRuntime.mark(function e(t,n){var r,o,a,i,c,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w(u.revealAnswerWorkflow(t));case 2:return r=e.sent,o=r.answerText,a=r.answerImg,i=r.answerAltText,e.next=8,w(h(f(o,n),a,i));case 8:c=e.sent,s=c.mediaUrls,u.addMediaUrlsToCard(t,s);case 11:case"end":return e.stop()}},e,this)})),c.apply(this,arguments)}function s(){var e=x.stream("statuses/filter",{track:"@".concat(g)});e.on("tweet",function(){var e=r(regeneratorRuntime.mark(function e(t){var n,r,o,a,i,c,s,l,f,h,x,g,y,T,b,A,R;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.in_reply_to_status_id_str,r=t.created_at,o=t.text,a=t.user,i=a.id,c=a.name,s=a.screen_name,l=a.profile_image_url_https,f=a.profile_banner_url,e.next=3,w(u.getLiveQuestions());case 3:if(h=e.sent,!(x=h.find(function(e){return e.questionId===n}))){e.next=16;break}if(g=x.alreadyAnswered,y=x.answers,!p(i,g)){e.next=9;break}return e.abrupt("return");case 9:return e.next=11,w(v(i));case 11:T=e.sent,b={userId:i,name:c,handle:s,avatar:l,profileBanner:f,following:T,allTimeStats:{score:0,attempts:0,correct:[]},monthlyStats:{score:0,attempts:0,correct:0},weeklyStats:{score:0,attempts:0,correct:0}},u.addOrUpdateUser(b),A=m(o),p(A,y)?(R=d(r,x),u.updateLiveQuestion(n,{userId:i,points:R})):u.updateLiveQuestion(n,{userId:i,points:0});case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),e.on("disconnect",function(t){console.error("Tweet stream disconnected:",t),setTimeout(function(){return e.start()},100)})}var u=n(2),l=n(0),f=(l.HOURS,l.addQuestionLink),d=l.calculateScore,p=l.contains,m=l.extractAnswer,v=l.getFollowing,h=(l.getTimeUntil,l.postMedia),w=l.tryCatch,x=n(3),g=process.env.TWITTER_ACCOUNT,y=4e4,T=1e4;e.exports={start:function(){s(),setInterval(o,T)}}},function(e,t){e.exports=require("mongodb")},function(e,t,n){function r(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return n}function o(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return r(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}function a(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){function a(e,t){try{var n=s[e](t),a=n.value}catch(e){return void o(e)}n.done?r(a):Promise.resolve(a).then(i,c)}function i(e){a("next",e)}function c(e){a("throw",e)}var s=e.apply(t,n);i()})}}function i(e){return new Promise(function(){var t=a(regeneratorRuntime.mark(function t(n,r){var o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:o=v.createReadStream(e).pipe(x.Extract({path:"uploads"})),o.on("close",a(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=v.readdirSync(g),e.next=3,_(c(g+"/media"));case 3:console.log("Finished optimizing images!"),r=s(t),p(t),n(r);case 7:case"end":return e.stop()}},e,this)})));case 2:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}())}function c(e){return new Promise(function(t,n){var r=[];v.readdirSync(e).forEach(function(t){if(/.*\.png$/.test(t)){var n=e+"/"+t,o=v.readFileSync(n),a=v.createWriteStream(n),i=new Promise(function(e,t){return a.on("close",e)});r.push(i),new h({filterType:4,deflateLevel:1}).parse(o,function(e,t){t.data[3]-=1,t.pack().pipe(a)})}}),Promise.all(r).then(t)})}function s(e){var t=[],n=!0,r=!1,o=void 0;try{for(var a,i=e[Symbol.iterator]();!(n=(a=i.next()).done);n=!0){var c=a.value,s="".concat(g,"/").concat(c);if(v.statSync(s).isFile()&&c.match(/.+\.json$/)){var l=u(s);t=t.concat(l)}}}catch(e){r=!0,o=e}finally{try{n||null==i.return||i.return()}finally{if(r)throw o}}return t}function u(e){return JSON.parse(v.readFileSync(e,"utf8")).notes.map(function(e){var t=o(e.fields,14),n=t[0],r=t[3],a=t[5],i=t[6],c=t[8],s=t[9],u=t[10],f=t[11],p=t[12],m=t[13],v=[n,r,p].map(l),h=o(v,3);n=h[0],r=h[1],p=h[2];var w=k(n,u);return{cardId:m,questionText:b(n,r,p,m),questionImg:d(a),questionAltText:T(n),prevLineImg:d(c),prevLineAltText:s,answerText:R(w,r,f,m),answerImg:d(i),answerAltText:A(n),answers:w,mediaUrls:[]}})}function l(e){return e.replace(/<.*?>|&.*;/g,"")}function f(e){return(e.match(/src="(.+)"/)||[,])[1]}function d(e){if(e&&0!==e.length){var t;try{t=v.readFileSync("".concat(g,"/media/").concat(f(e)),{encoding:"base64"})}catch(e){}return t}}function p(e){var t=!0,n=!1,r=void 0;try{for(var o,a=e[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var i=o.value,c="".concat(g,"/").concat(i);v.lstatSync(c).isFile()?v.unlinkSync(c):v.lstatSync(c).isDirectory()&&m(c)}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}function m(e){v.existsSync(e)&&(v.readdirSync(e).forEach(function(t){var n=e+"/"+t;v.lstatSync(n).isDirectory()?m(n):v.unlinkSync(n)}),v.rmdirSync(e))}var v=n(13),h=n(14).PNG,w=n(1),x=n(15),g=w.resolve(__dirname,"../uploads"),y=n(0),T=y.formatQuestionAltText,b=y.formatQuestionText,A=y.formatAnswerAltText,R=y.formatAnswerText,k=y.getAnswers,_=y.tryCatch;e.exports={processUpload:i,parseAnkiJson:u,optimizeImages:c}},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("pngjs2")},function(e,t){e.exports=require("unzip-stream")},function(e,t,n){function r(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){function a(e,t){try{var n=s[e](t),a=n.value}catch(e){return void o(e)}n.done?r(a):Promise.resolve(a).then(i,c)}function i(e){a("next",e)}function c(e){a("throw",e)}var s=e.apply(t,n);i()})}}function o(e,t){return new Promise(function(n,r){a.post("media/upload",{media_data:e},function(e,o,i){if(e)return console.error(e),void r(new Error("Media upload failed."));var c=o.media_id_string,s={media_id:c,alt_text:{text:t}};a.post("media/metadata/create",s,function(e,t,o){e&&(console.error(e),r(new Error("Media upload succeeded, media creation failed."))),n(c)})})})}var a=n(3),i=n(4),c=i.tryCatch;e.exports={postMedia:function(e,t,n,i,s){return new Promise(function(){var u=r(regeneratorRuntime.mark(function r(u,l){var f,d,p,m;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,c(o(t,n));case 2:if(f=r.sent,d=[f],!i){r.next=9;break}return r.next=7,c(o(i,s));case 7:p=r.sent,d.unshift(p);case 9:m={status:e,media_ids:d,tweet_mode:"extended",include_ext_alt_text:!0},a.post("statuses/update",m,function(e,t,n){e&&(console.error(e),l(new Error("Posting status failed.")));var r=t.extended_entities.media.map(function(e){return{image:e.media_url_https,altText:e.ext_alt_text}}),o={questionId:t.id_str,questionPostedAt:t.created_at,mediaUrls:r};u(o)});case 11:case"end":return r.stop()}},r,this)}));return function(e,t){return u.apply(this,arguments)}}())},getFollowing:function(e){return new Promise(function(t,n){a.get("friends/ids",{userId:e},function(e,n,r){e&&console.error(e),t(n.ids)})})}}},function(e,t){e.exports=require("twit")},function(e,t){e.exports=require("urlencode")},function(e,t,n){var r=n(2),o=n(20)({dest:"uploads/"});e.exports=function(e){e.use(function(e,t,n){t.header("Access-Control-Allow-Origin","*"),t.header("Access-Control-Allow-Methods","GET, OPTIONS"),t.header("Access-Control-Max-Age","86400"),t.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),n()}),e.get("/api/live",function(e,t){r.serveLiveQuestions(e,t)}),e.get("/api/scores",function(e,t){r.getScores(e,t)}),e.get("/api/cards",function(e,t){r.getCards(e,t)}),e.get("/api/score/:handle",function(e,t){r.getScore(e,t)}),e.get("/api/cards/old",function(e,t){r.getOldCards(e,t)}),e.post("/deck/new",o.single("zipfile"),function(e,t){r.addDeck(e,t)}),e.post("/scores/edit",function(e,t){r.adjustScore(e,t)}),e.get("/cards/new",function(e,t){r.getNewCards(e,t)})}},function(e,t){e.exports=require("multer")}]);